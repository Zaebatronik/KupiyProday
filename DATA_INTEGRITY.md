# –°–∏—Å—Ç–µ–º–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö - "–ö–∞–∫ —á–∞—Å—ã"

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã: Telegram ID

**Telegram ID** - —ç—Ç–æ immutable (–Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π) –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –í—ã–¥–∞–µ—Ç—Å—è Telegram –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞
- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ PRIMARY KEY –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö

```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º telegramId
const userId = getTelegramId(); // "670170626"

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º nickname –∫–∞–∫ ID
const userId = user.nickname; // "Adminisus" - –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è!
```

---

## üìä –ü—Ä–∏–≤—è–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (User)
```javascript
{
  _id: ObjectId("..."),           // MongoDB ID
  telegramId: "670170626",        // PRIMARY KEY ‚≠ê
  nickname: "Adminisus",          // UNIQUE, –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è
  telegramUsername: "Danylo24",   // –ú–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
  city: "–í–∏–ª—å–≥–µ–ª—å–º—Å—Ö–∞—Ñ–µ–Ω",
  country: "DE",
  banned: false
}
```

**–ò–Ω–¥–µ–∫—Å—ã:**
- `{ telegramId: 1, unique: true }` - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
- `{ nickname: 1, unique: true }` - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∏–∫–Ω–µ–π–º–∞

---

### –û–±—ä—è–≤–ª–µ–Ω–∏–µ (Listing)
```javascript
{
  _id: ObjectId("..."),
  serialNumber: "Adminisus_12345",
  userId: "670170626",            // ‚≠ê –ü—Ä–∏–≤—è–∑–∫–∞ –∫ telegramId –≤–ª–∞–¥–µ–ª—å—Ü–∞
  userNickname: "Adminisus",      // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–æ–∂–µ—Ç —É—Å—Ç–∞—Ä–µ—Ç—å)
  title: "–ü—Ä–æ–¥–∞—é iPhone",
  description: "...",
  price: 500,
  city: "–ë–µ—Ä–ª–∏–Ω",
  country: "DE",
  photos: [...],
  status: "active",
  views: 42,
  createdAt: "2025-11-28T20:00:00Z"
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- `userId` = `telegramId` –≤–ª–∞–¥–µ–ª—å—Ü–∞
- –ü—Ä–∏ —Å–º–µ–Ω–µ –Ω–∏–∫–Ω–µ–π–º–∞ `userNickname` **–ù–ï –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –û–±—ä—è–≤–ª–µ–Ω–∏–µ **–Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è** –ø—Ä–∏ —Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–æ—Ç –∂–µ telegramId)

---

### –ß–∞—Ç (Chat)
```javascript
{
  _id: ObjectId("..."),
  participant1: "670170626",      // ‚≠ê telegramId –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  participant2: "417964053",      // ‚≠ê telegramId –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  participantsInfo: {
    "670170626": {
      nickname: "Adminisus",
      language: "ru",
      contactsShared: false
    },
    "417964053": {
      nickname: "–õ–∞–±—É–±–∞",
      language: "ru",
      contactsShared: true
    }
  },
  messages: [
    {
      _id: ObjectId("..."),
      senderId: "670170626",      // ‚≠ê telegramId –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
      text: "–ü—Ä–∏–≤–µ—Ç!",
      createdAt: "2025-11-28T20:05:00Z"
    }
  ],
  createdAt: "2025-11-28T20:00:00Z",
  updatedAt: "2025-11-28T20:05:00Z"
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- `participant1` –∏ `participant2` = `telegramId`
- `senderId` = `telegramId` –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- –ß–∞—Ç **–Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è** –ø—Ä–∏ —Å–º–µ–Ω–µ –Ω–∏–∫–Ω–µ–π–º–∞

---

## üîí Backend –∑–∞—â–∏—Ç–∞

### 1. Middleware: verifyTelegramAuth
**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞:**
```javascript
// –ò–∑–≤–ª–µ–∫–∞–µ—Ç telegramId –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ initData
const user = JSON.parse(params.get('user'));
req.userId = user.id.toString(); // ‚≠ê –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ req.userId

// –í—Å–µ —Ä–æ—É—Ç—ã –ø–æ–ª—É—á–∞—é—Ç –ü–†–û–í–ï–†–ï–ù–ù–´–ô userId
```

**–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞:**
- `POST /listings` - —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- `PUT /listings/:id` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `DELETE /listings/:id` - —É–¥–∞–ª–µ–Ω–∏–µ
- `POST /chats/:id/messages` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

---

### 2. Middleware: checkNotBanned
**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```javascript
const user = await User.findOne({ telegramId: req.userId });

if (user.banned) {
  return res.status(403).json({ error: 'Your account is banned' });
}

req.user = user; // ‚≠ê –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î
```

---

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
**–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏:**
```javascript
// PUT /listings/:id
const listing = await Listing.findById(req.params.id);

if (listing.userId !== req.userId) {
  return res.status(403).json({ 
    message: '–ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è' 
  });
}
```

---

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–∞—Ç–∞
**–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```javascript
// POST /chats/:id/messages
const senderId = req.userId; // ‚≠ê –ò–∑ middleware, –Ω–µ –∏–∑ req.body!

if (senderId !== chat.participant1 && senderId !== chat.participant2) {
  return res.status(403).json({ 
    message: '–í—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º —ç—Ç–æ–≥–æ —á–∞—Ç–∞' 
  });
}
```

---

## üé® Frontend –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –ï–¥–∏–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞: utils/user.ts
```typescript
// ‚úÖ –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = getCurrentUser();

// ‚úÖ –ü–æ–ª—É—á–∏—Ç—å Telegram ID
const userId = getCurrentUserId(); // "670170626"

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞
if (isOwner(listing)) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —á–∞—Ç–∞
if (isChatParticipant(chat)) {
  // –†–∞–∑—Ä–µ—à–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
}

// ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–¥–º–∏–Ω–∞
if (isAdmin()) {
  // –ü–æ–∫–∞–∑–∞—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
}
```

---

### 2. Zustand Store - –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```typescript
const { user, isRegistered } = useStore();

// user —Å–æ–¥–µ—Ä–∂–∏—Ç:
{
  id: "670170626",           // telegramId
  telegramId: "670170626",   // –¥—É–±–ª–∏–∫–∞—Ç –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
  nickname: "Adminisus",
  city: "–í–∏–ª—å–≥–µ–ª—å–º—Å—Ö–∞—Ñ–µ–Ω",
  country: "DE",
  language: "ru",
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–µ
}
```

---

### 3. useAuthGuard - –∑–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
```typescript
export default function CatalogPage() {
  useAuthGuard(); // ‚≠ê –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
  // 1. isRegistered === true?
  // 2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ?
  // 3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí logout() + —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
}
```

---

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç
2. getTelegramId() ‚Üí "670170626"
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±–∞–∑–µ: GET /users/telegram/670170626 ‚Üí 404
4. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–∏–∫–Ω–µ–π–º "Adminisus"
6. POST /users/register { id: "670170626", nickname: "Adminisus" }
7. MongoDB —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å:
   {
     telegramId: "670170626",
     nickname: "Adminisus"
   }
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–°–æ–∑–¥–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"
2. –ó–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É: title, description, price
3. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: POST /listings
   Headers: { x-telegram-init-data: "..." }
4. Backend:
   - verifyTelegramAuth ‚Üí req.userId = "670170626"
   - checkNotBanned ‚Üí req.user = { nickname: "Adminisus", ... }
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä—è–≤–ª–µ–Ω–∏–µ:
   {
     userId: "670170626",        ‚≠ê –ò–∑ req.userId
     userNickname: "Adminisus",  ‚≠ê –ò–∑ req.user.nickname
     title: "–ü—Ä–æ–¥–∞—é iPhone",
     ...
   }
6. –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ MongoDB
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–º–µ–Ω–∞ –Ω–∏–∫–Ω–µ–π–º–∞ (–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π)
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "Adminisus" (telegramId: 670170626) –º–µ–Ω—è–µ—Ç –Ω–∏–∫–Ω–µ–π–º –Ω–∞ "SuperAdmin"
2. PUT /users/670170626 { nickname: "SuperAdmin" }
3. MongoDB –æ–±–Ω–æ–≤–ª—è–µ—Ç:
   {
     telegramId: "670170626",    ‚Üê –ù–ï –ò–ó–ú–ï–ù–ò–õ–°–Ø
     nickname: "SuperAdmin"      ‚Üê –ò–∑–º–µ–Ω–∏–ª—Å—è
   }
4. –°—Ç–∞—Ä—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è:
   {
     userId: "670170626",        ‚Üê –ù–ï –ò–ó–ú–ï–ù–ò–õ–°–Ø ‚≠ê
     userNickname: "Adminisus"   ‚Üê –£—Å—Ç–∞—Ä–µ–ª, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
   }
5. –ù–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –±—É–¥—É—Ç —Å –Ω–æ–≤—ã–º –Ω–∏–∫–Ω–µ–π–º–æ–º
6. –í–°–ï –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ userId)
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–∫–∞–∫ –±—ã–ª–æ)
```
1. –ê–¥–º–∏–Ω –≤—ã–∑—ã–≤–∞–µ—Ç: DELETE /users/admin/delete-all-users
2. MongoDB —É–¥–∞–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. Natali –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç:
   - isRegistered: true (localStorage)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: GET /users/telegram/123456789 ‚Üí 404
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π logout()
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
4. Natali —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ —Å —Ç–µ–º –∂–µ telegramId
5. –ü–†–û–ë–õ–ï–ú–ê: –°—Ç–∞—Ä—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å userId="123456789" –æ—Å—Ç–∞–ª–∏—Å—å!
6. –†–µ—à–µ–Ω–∏–µ: –ü–æ—Å–ª–µ —Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–Ω–∏ —Å–Ω–æ–≤–∞ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –Ω–µ–π
```

**–í—ã–≤–æ–¥:** –û–±—ä—è–≤–ª–µ–Ω–∏—è –ù–ï —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, —Ç.–∫. –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ telegramId

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü–æ–ø—ã—Ç–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A (telegramId: 670170626) –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B
2. Frontend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: PUT /listings/abc123
   Headers: { x-telegram-init-data: "..." }
3. Backend:
   - verifyTelegramAuth ‚Üí req.userId = "670170626"
   - –ù–∞—Ö–æ–¥–∏–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ: { userId: "417964053", ... }
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: 670170626 !== 417964053
   - return 403 Forbidden
4. Frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É
```

---

### –°—Ü–µ–Ω–∞—Ä–∏–π 6: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å A –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
2. Frontend: POST /chats/chatId123/messages { text: "–ü—Ä–∏–≤–µ—Ç" }
3. Backend:
   - verifyTelegramAuth ‚Üí req.userId = "670170626"
   - senderId = req.userId (–ù–ï –∏–∑ req.body!)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: 670170626 === chat.participant1? ‚úÖ
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ:
     {
       senderId: "670170626",
       text: "–ü—Ä–∏–≤–µ—Ç"
     }
4. Socket.IO –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±–æ–∏–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
```

---

## üö´ –ß—Ç–æ –ù–ï–í–û–ó–ú–û–ñ–ù–û

### ‚ùå –ó–∞–π—Ç–∏ –ø–æ–¥ —á—É–∂–∏–º –Ω–∏–∫–æ–º
- –ù–∏–∫–Ω–µ–π–º –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –¢–æ–ª—å–∫–æ Telegram ID (–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –∑–∞—â–∏—â–µ–Ω)

### ‚ùå –ü–æ—Ç–µ—Ä—è—Ç—å —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- –û–±—ä—è–≤–ª–µ–Ω–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ telegramId
- –ü—Ä–∏ —Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —Ç–µ–º –∂–µ Telegram –∞–∫–∫–∞—É–Ω—Ç–æ–º - –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—é—Ç—Å—è

### ‚ùå –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: `listing.userId === req.userId`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403 Forbidden

### ‚ùå –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —á—É–∂–æ–≥–æ –∏–º–µ–Ω–∏
- `senderId` –±–µ—Ä–µ—Ç—Å—è –∏–∑ `req.userId` (–∏–∑ middleware)
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–¥–µ–ª–∞—Ç—å —á–µ—Ä–µ–∑ `req.body`

### ‚ùå –ü–æ–ø–∞—Å—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- useAuthGuard –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- App.tsx –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î

---

## ‚úÖ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

### ‚úÖ –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–Ω–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
import { getCurrentUser, getCurrentUserId, isOwner } from '../utils/user';

export default function MyListingsPage() {
  useAuthGuard(); // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  
  const currentUserId = getCurrentUserId(); // "670170626"
  const listings = await listingsAPI.getByUser(currentUserId);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
}
```

---

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
```typescript
// –í useAuthGuard
if (!isRegistered) {
  navigate('/', { replace: true }); // ‚Üí –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
}

// –í App.tsx routing
{!isRegistered ? (
  <Route path="*" element={<Navigate to="/" replace />} />
) : (
  // –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
)}
```

---

### ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ–ª–∫–∏ –¥–∞–Ω–Ω—ã—Ö
**Backend:**
- `verifyTelegramAuth` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø–æ–¥–ø–∏—Å—å
- `req.userId` –±–µ—Ä–µ—Ç—Å—è –¢–û–õ–¨–ö–û –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ initData
- –ù–ï –¥–æ–≤–µ—Ä—è–µ—Ç `req.body.userId`

**Frontend:**
- `getTelegramId()` –±–µ—Ä–µ—Ç –∏–∑ `Telegram.WebApp.initDataUnsafe`
- –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ID –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞

---

## üìù –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

- [ ] –î–æ–±–∞–≤–∏—Ç—å `useAuthGuard()` –≤ –Ω–∞—á–∞–ª–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `getCurrentUserId()` –≤–º–µ—Å—Ç–æ `user.id`
- [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–µ—Ä–µ–∑ `isOwner(listing)`
- [ ] –ù–ï –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `userId` –≤ req.body (–±–µ—Ä–µ—Ç—Å—è –∏–∑ middleware)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `telegramId` –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –ù–ï nickname

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:

- [ ] –î–æ–±–∞–≤–∏—Ç—å `verifyTelegramAuth` middleware
- [ ] –î–æ–±–∞–≤–∏—Ç—å `checkNotBanned` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `req.userId` –≤–º–µ—Å—Ç–æ `req.body.userId`
- [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞: `item.userId === req.userId`
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `telegramId` –≤ —Å—Ö–µ–º–∞—Ö –º–æ–¥–µ–ª–µ–π

---

## üéØ –ò—Ç–æ–≥–æ: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —á–∞—Å—ã

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
- ‚úÖ –û–¥–∏–Ω Telegram ID = –æ–¥–∏–Ω –∞–∫–∫–∞—É–Ω—Ç
- ‚úÖ –ù–∏–∫–Ω–µ–π–º –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å
- ‚úÖ –ù–µ–ª—å–∑—è –∑–∞–π—Ç–∏ –ø–æ–¥ —á—É–∂–∏–º –Ω–∏–∫–æ–º

**–û–±—ä—è–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–∏–≤—è–∑–∞–Ω—ã –∫ telegramId –≤–ª–∞–¥–µ–ª—å—Ü–∞
- ‚úÖ –ù–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Ä–µ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å

**–°–æ–æ–±—â–µ–Ω–∏—è:**
- ‚úÖ –ê–¥—Ä–µ—Å–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é
- ‚úÖ senderId = telegramId –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç —á—É–∂–æ–≥–æ –∏–º–µ–Ω–∏

**–ù–∞–≤–∏–≥–∞—Ü–∏—è:**
- ‚úÖ –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–Ω–∞–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ‚Üí –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ —Ü–µ–ª–æ—Å—Ç–Ω–∞, –±–µ–∑–æ–ø–∞—Å–Ω–∞ –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞. üéâ
